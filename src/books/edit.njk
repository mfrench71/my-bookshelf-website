---
layout: base.njk
title: Edit Book
scripts: '<script type="module" src="/js/books/edit.js"></script>'
---
<!-- Sub-navigation -->
<div class="bg-white border-b border-gray-200 sticky top-14 z-30">
  <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-between">
    <button id="back-btn" class="p-2 -ml-2 hover:bg-gray-100 rounded-lg flex items-center gap-2 text-gray-600">
      <i data-lucide="arrow-left" class="w-4 h-4"></i>
      <span class="text-sm">Cancel</span>
    </button>
    <button id="refresh-data-btn" class="p-2 hover:bg-gray-100 rounded-lg text-gray-600 flex items-center gap-1" title="Refresh from API">
      <i data-lucide="refresh-cw" class="w-4 h-4"></i>
      <span class="text-sm">Refresh Data</span>
    </button>
  </div>
</div>

<!-- Loading (Skeleton Form) -->
<div id="loading" class="max-w-2xl mx-auto px-4 py-6">
  <div class="skeleton skeleton-text h-7 w-32 mb-6"></div>
  <div class="bg-white rounded-xl border border-gray-200 p-4 space-y-4">
    <!-- Cover skeleton -->
    <div class="flex gap-4">
      <div class="skeleton w-24 h-36 rounded-lg flex-shrink-0"></div>
      <div class="flex-1 space-y-2">
        <div class="skeleton skeleton-text w-full"></div>
        <div class="skeleton skeleton-text w-3/4"></div>
      </div>
    </div>
    <!-- Form fields skeleton -->
    <div class="skeleton skeleton-text h-4 w-16"></div>
    <div class="skeleton h-10 w-full rounded-lg"></div>
    <div class="skeleton skeleton-text h-4 w-16"></div>
    <div class="skeleton h-10 w-full rounded-lg"></div>
    <div class="skeleton skeleton-text h-4 w-16"></div>
    <div class="skeleton h-10 w-full rounded-lg"></div>
  </div>
</div>

<!-- Edit Form -->
<main id="main-content" class="hidden max-w-2xl mx-auto px-4 py-6 page-content">
  <h1 id="page-title" class="text-xl font-bold text-gray-900 mb-6">Edit Book</h1>

  <form id="edit-form" class="bg-white rounded-xl border border-gray-200 p-4 space-y-4">
    <div>
      <label class="block font-semibold text-gray-700 mb-1">Title</label>
      <input type="text" id="title" required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Author</label>
      <input type="text" id="author" required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Cover Image</label>
      <input type="hidden" id="cover-url">
      <div id="cover-picker" class="hidden">
        <div class="flex gap-4 flex-wrap">
          <div id="cover-option-google" class="cover-option hidden cursor-pointer rounded-lg border-2 border-transparent hover:border-primary p-1 transition-colors relative" data-source="googleBooks">
            <div class="text-xs text-gray-500 text-center mb-1">Google Books</div>
            <img src="" alt="Google Books cover" loading="lazy" class="w-16 h-24 rounded object-cover mx-auto">
            <div class="cover-selected-badge hidden absolute -top-1 -right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center shadow">
              <i data-lucide="check" class="w-3 h-3 text-white"></i>
            </div>
          </div>
          <div id="cover-option-openlibrary" class="cover-option hidden cursor-pointer rounded-lg border-2 border-transparent hover:border-primary p-1 transition-colors relative" data-source="openLibrary">
            <div class="text-xs text-gray-500 text-center mb-1">Open Library</div>
            <img src="" alt="Open Library cover" loading="lazy" class="w-16 h-24 rounded object-cover mx-auto">
            <div class="cover-selected-badge hidden absolute -top-1 -right-1 w-5 h-5 bg-primary rounded-full flex items-center justify-center shadow">
              <i data-lucide="check" class="w-3 h-3 text-white"></i>
            </div>
          </div>
        </div>
        <p id="cover-picker-hint" class="text-xs text-gray-400 mt-2 hidden">Click to select a different cover</p>
      </div>
      <p id="no-cover-msg" class="text-sm text-gray-400 hidden">No cover available</p>
    </div>

    <!-- Series (read-only) -->
    <div id="series-section" class="hidden">
      <label class="block font-semibold text-gray-700 mb-1">Series</label>
      <div class="flex items-center gap-2 px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-gray-700">
        <i data-lucide="library" class="w-4 h-4 text-gray-400"></i>
        <span id="series-display"></span>
      </div>
      <input type="hidden" id="series-name">
      <input type="hidden" id="series-position">
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Publisher</label>
        <input type="text" id="publisher"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Published Date</label>
        <input type="text" id="published-date"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Format</label>
        <select id="physical-format"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white">
          <option value="">Select format...</option>
          <option value="Paperback">Paperback</option>
          <option value="Hardcover">Hardcover</option>
          <option value="Mass Market Paperback">Mass Market Paperback</option>
          <option value="Trade Paperback">Trade Paperback</option>
          <option value="Library Binding">Library Binding</option>
          <option value="Spiral-bound">Spiral-bound</option>
          <option value="Audio CD">Audio CD</option>
          <option value="Ebook">Ebook</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Pages</label>
        <input type="number" id="page-count" min="1" placeholder="e.g., 320" inputmode="numeric"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-2">Rating</label>
      <div id="rating-input"></div>
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-2">Reading Dates</label>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm text-gray-500 mb-1">Started</label>
          <input type="date" id="started-date"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
        </div>
        <div>
          <label class="block text-sm text-gray-500 mb-1">Finished</label>
          <input type="date" id="finished-date"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
        </div>
      </div>
      <p id="reading-date-error" class="text-sm text-red-600 mt-1 hidden"></p>
      <div class="flex items-center gap-2 mt-3">
        <button type="button" id="reread-btn"
          class="px-3 py-1.5 rounded-lg border border-gray-300 text-sm flex items-center gap-1.5 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
          <span>Start Re-read</span>
        </button>
        <span id="reading-status-badge" class="px-2 py-0.5 text-xs rounded-full"></span>
      </div>
      <!-- Read History -->
      <div id="read-history-section" class="mt-3 hidden">
        <button type="button" id="toggle-history" class="flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700">
          <i data-lucide="chevron-right" class="w-4 h-4 transition-transform" id="history-chevron"></i>
          <span>Read History (<span id="history-count">0</span> previous reads)</span>
        </button>
        <div id="read-history-list" class="hidden mt-2 pl-5 border-l-2 border-gray-200 space-y-1 text-sm text-gray-500"></div>
      </div>
    </div>

    <div id="genre-picker-container"></div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Notes</label>
      <textarea id="notes" rows="3"
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none"></textarea>
    </div>

    <div class="flex gap-3 pt-2">
      <button type="button" id="cancel-btn"
        class="flex-1 py-3 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium">
        Cancel
      </button>
      <button type="submit" id="save-btn"
        class="flex-1 bg-primary hover:bg-primary-dark text-white font-medium py-3 px-4 rounded-lg transition-colors">
        Save Changes
      </button>
    </div>
  </form>
</main>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-6 left-4 right-4 sm:left-auto sm:right-4 sm:w-80 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg z-50"></div>
