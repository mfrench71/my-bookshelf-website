---
layout: base.njk
title: Add Book
headScripts: '<script src="/vendor/quagga.min.js"></script>'
scripts: '<script type="module" src="/js/books/add.js"></script>'
---
<!-- Sub-navigation -->
<div class="bg-white border-b border-gray-200 sticky top-14 z-30">
  <div class="max-w-6xl mx-auto px-4 py-2 flex items-center gap-3">
    <a href="/books/" class="p-2 hover:bg-gray-100 rounded-lg flex items-center gap-2 text-gray-600 min-h-[44px]">
      <i data-lucide="arrow-left" class="w-5 h-5" aria-hidden="true"></i>
      <span class="text-sm">Back to Books</span>
    </a>
  </div>
</div>

<main id="main-content" class="max-w-6xl mx-auto px-4 py-6 page-content">
  <!-- Scan Button -->
  <button id="scan-btn"
    class="w-full flex items-center justify-center gap-3 py-4 px-4 bg-primary text-white rounded-xl mb-6 hover:bg-primary-dark transition-colors">
    <i data-lucide="scan-line" class="w-6 h-6"></i>
    <span class="font-medium">Scan ISBN Barcode</span>
  </button>

  <!-- ISBN Lookup -->
  <div class="bg-white rounded-xl border border-gray-200 p-4 mb-6">
    <label class="block font-semibold text-gray-700 mb-2">Lookup by ISBN</label>
    <div class="flex gap-2">
      <input type="text" id="isbn-input" placeholder="Enter ISBN..." inputmode="numeric"
        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      <button id="lookup-btn"
        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg font-medium transition-colors">
        Lookup
      </button>
    </div>
    <p id="lookup-status" class="text-sm text-gray-500 mt-2 hidden"></p>
  </div>

  <!-- Book Search -->
  <div class="bg-white rounded-xl border border-gray-200 p-4 mb-6">
    <label class="block font-semibold text-gray-700 mb-2">Search by Title or Author</label>
    <div class="relative">
      <input type="text" id="book-search" placeholder="Start typing to search..."
        class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      <button type="button" id="clear-search" class="hidden absolute right-2 top-1/2 -translate-y-1/2 p-2 hover:bg-gray-100 rounded-full text-gray-400 hover:text-gray-600" aria-label="Clear search">
        <i data-lucide="x" class="w-4 h-4" aria-hidden="true"></i>
      </button>
    </div>
    <div id="book-search-results" class="mt-3 space-y-2 max-h-64 overflow-y-auto hidden"></div>
  </div>

  <div class="relative mb-6">
    <div class="absolute inset-0 flex items-center">
      <div class="w-full border-t border-gray-200"></div>
    </div>
    <div class="relative flex justify-center">
      <span class="bg-gray-50 px-3 text-sm text-gray-400">or enter manually</span>
    </div>
  </div>

  <!-- Book Form -->
  <form id="book-form" class="bg-white rounded-xl border border-gray-200 p-4 space-y-4">
    <div>
      <label class="block font-semibold text-gray-700 mb-1">Title *</label>
      <input type="text" id="title" required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Author *</label>
      <input type="text" id="author" required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
    </div>

    <div id="series-picker-container"></div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Cover Image</label>
      <input type="hidden" id="cover-url">
      <div id="cover-picker-container"></div>
      <p id="cover-picker-hint" class="text-xs text-gray-400 mt-2 hidden">Click to select a different cover</p>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Publisher</label>
        <input type="text" id="publisher"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Published Date</label>
        <input type="text" id="published-date"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Format</label>
        <select id="physical-format"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white">
          <option value="">Select format...</option>
          <option value="Paperback">Paperback</option>
          <option value="Hardcover">Hardcover</option>
          <option value="Mass Market Paperback">Mass Market Paperback</option>
          <option value="Trade Paperback">Trade Paperback</option>
          <option value="Library Binding">Library Binding</option>
          <option value="Spiral-bound">Spiral-bound</option>
          <option value="Audio CD">Audio CD</option>
          <option value="Ebook">Ebook</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold text-gray-700 mb-1">Pages</label>
        <input type="number" id="page-count" min="1" placeholder="e.g., 320" inputmode="numeric"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
    </div>

    <div>
      <label class="block font-semibold text-gray-700 mb-2">Rating</label>
      <div id="rating-input"></div>
    </div>

    <div id="genre-picker-container"></div>

    <div>
      <label class="block font-semibold text-gray-700 mb-1">Notes</label>
      <textarea id="notes" rows="3" placeholder="Your thoughts about this book..."
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none"></textarea>
    </div>

    <button type="submit" id="submit-btn"
      class="w-full bg-primary hover:bg-primary-dark text-white font-medium py-3 px-4 rounded-lg transition-colors">
      Add Book
    </button>
  </form>
</main>

<!-- Scanner Modal -->
<div id="scanner-modal" class="hidden fixed inset-0 bg-black z-50">
  <div class="absolute top-0 left-0 right-0 p-4 bg-gradient-to-b from-black/70 to-transparent z-10 flex items-center justify-between">
    <h2 class="text-lg font-semibold text-white">Scan Barcode</h2>
    <button id="close-scanner" class="p-2 text-white" aria-label="Close scanner">
      <i data-lucide="x" class="w-6 h-6" aria-hidden="true"></i>
    </button>
  </div>
  <div id="scanner-container" class="w-full h-full"></div>
  <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/70 to-transparent text-center">
    <p class="text-white">Position the barcode within the frame</p>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-6 left-4 right-4 sm:left-auto sm:right-4 sm:w-80 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg z-50"></div>
