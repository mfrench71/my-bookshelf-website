---
layout: base.njk
title: Profile Settings
scripts: '<script type="module" src="/js/settings/profile.js"></script>'
---
<!-- Sub-navigation -->
<div class="bg-white border-b border-gray-200 sticky top-14 z-30">
  <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-between min-h-[52px]">
    <nav aria-label="Breadcrumb">
      <ol class="flex items-center text-sm">
        <li class="flex items-center min-w-0">
          <a href="/" class="text-gray-500 hover:text-primary hover:underline">Home</a>
        </li>
        <li class="flex items-center min-w-0">
          <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 mx-1 flex-shrink-0" aria-hidden="true"></i>
          <span class="text-gray-900 font-medium" aria-current="page">Settings</span>
        </li>
      </ol>
    </nav>
  </div>
</div>

{% set activePage = 'profile' %}
{% include "settings-nav.njk" %}

<div class="max-w-2xl mx-auto px-4 py-6 page-content">
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Profile</h1>

  <!-- User Info - Loading State -->
  <div id="profile-loading" class="bg-white rounded-xl border border-gray-200 p-6 mb-6">
    <div class="flex items-center gap-4">
      <div class="skeleton w-16 h-16 rounded-full"></div>
      <div class="space-y-2 flex-1">
        <div class="skeleton h-4 w-40 rounded"></div>
        <div class="skeleton h-3 w-32 rounded"></div>
      </div>
    </div>
  </div>

  <!-- User Info - Content -->
  <div id="profile-content" class="hidden bg-white rounded-xl border border-gray-200 p-6 mb-6">
    <div class="flex items-center gap-4">
      <button id="edit-avatar-btn" class="relative group cursor-pointer" aria-label="Edit profile photo">
        <div id="profile-avatar" class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white text-2xl font-bold overflow-hidden">
          <!-- Initial, Gravatar, or uploaded photo -->
        </div>
        <!-- Hover overlay for desktop -->
        <div class="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <i data-lucide="camera" class="w-5 h-5 text-white" aria-hidden="true"></i>
        </div>
        <!-- Edit badge for mobile (hidden on desktop where hover works) -->
        <div class="absolute -bottom-0.5 -right-0.5 w-6 h-6 bg-primary rounded-full flex items-center justify-center shadow-md md:hidden">
          <i data-lucide="pencil" class="w-3 h-3 text-white" aria-hidden="true"></i>
        </div>
      </button>
      <div>
        <p id="profile-email" class="text-gray-900 font-medium"></p>
        <p class="text-gray-500 text-sm">Member since <span id="profile-created"></span></p>
      </div>
    </div>
  </div>

  <div class="space-y-4">
    <!-- Email Verification Status -->
    <div id="email-verification-section" class="hidden bg-white rounded-xl border border-gray-200 p-6">
      <div class="flex items-center justify-between gap-4">
        <div class="flex items-center gap-3 min-w-0">
          <i id="verification-icon" data-lucide="mail-check" class="w-5 h-5 text-green-600" aria-hidden="true"></i>
          <div>
            <h3 class="font-medium text-gray-900">Email Verification</h3>
            <p id="verification-status" class="text-gray-500 text-sm mt-0.5">Verified</p>
          </div>
        </div>
        <button id="resend-verification-btn" class="hidden flex-shrink-0 flex items-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-100 text-gray-700 text-sm rounded-lg transition-colors min-h-[44px]">
          <i data-lucide="send" class="w-4 h-4" aria-hidden="true"></i>
          <span>Resend</span>
        </button>
      </div>
    </div>

    <!-- Change Password -->
    <div class="bg-white rounded-xl border border-gray-200 p-6">
      <div class="flex items-center justify-between gap-4">
        <div class="min-w-0">
          <h3 class="font-medium text-gray-900">Change Password</h3>
          <p class="text-gray-500 text-sm mt-1">Update your account password</p>
        </div>
        <button id="change-password-btn" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white text-sm rounded-lg transition-colors min-h-[44px]">
          <i data-lucide="key" class="w-4 h-4" aria-hidden="true"></i>
          <span>Change</span>
        </button>
      </div>
    </div>

    <!-- Privacy & Data -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-100">
        <h3 class="font-medium text-gray-900">Privacy & Data</h3>
        <p class="text-gray-500 text-sm mt-1">Manage your data and privacy preferences</p>
      </div>

      <!-- Privacy Policy -->
      <a href="/privacy/" class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition-colors border-b border-gray-100">
        <div class="flex items-center gap-3">
          <i data-lucide="file-text" class="w-5 h-5 text-gray-400" aria-hidden="true"></i>
          <div>
            <p class="font-medium text-gray-900">Privacy Policy</p>
            <p class="text-gray-500 text-sm">Learn how your data is collected and used</p>
          </div>
        </div>
        <i data-lucide="external-link" class="w-4 h-4 text-gray-400" aria-hidden="true"></i>
      </a>

      <!-- Export Data (link to Library) -->
      <a href="/settings/library/#backup" class="flex items-center justify-between px-6 py-4 hover:bg-gray-50 transition-colors">
        <div class="flex items-center gap-3">
          <i data-lucide="download" class="w-5 h-5 text-gray-400" aria-hidden="true"></i>
          <div>
            <p class="font-medium text-gray-900">Export My Data</p>
            <p class="text-gray-500 text-sm">Download all your books, genres, and settings</p>
          </div>
        </div>
        <i data-lucide="arrow-right" class="w-4 h-4 text-gray-400" aria-hidden="true"></i>
      </a>
    </div>

    <!-- Delete Account -->
    <div class="bg-red-50 rounded-xl border border-red-200 p-6">
      <div class="flex items-center justify-between gap-4">
        <div class="min-w-0">
          <h3 class="font-medium text-red-900">Delete Account</h3>
          <p class="text-red-700 text-sm mt-1">Permanently delete your account and all data</p>
        </div>
        <button id="delete-account-btn" class="flex-shrink-0 flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors min-h-[44px]">
          <i data-lucide="trash-2" class="w-4 h-4" aria-hidden="true"></i>
          <span>Delete</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Profile Photo Bottom Sheet -->
<div id="photo-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4">
  <div class="bottom-sheet-content bg-white w-full md:max-w-md p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-4">Profile Photo</h3>
    <div class="flex flex-col items-center">
      <div id="photo-preview" class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden mb-4">
        <i data-lucide="user" class="w-10 h-10 text-gray-400" aria-hidden="true"></i>
      </div>
      <p class="text-gray-500 text-sm text-center mb-1">JPG, PNG or WebP. Max 500KB.</p>
      <p class="text-gray-400 text-xs text-center mb-4">Falls back to Gravatar if no photo uploaded.</p>
      <input type="file" id="photo-input" accept="image/jpeg,image/png,image/webp" class="hidden">
      <div class="flex items-center gap-2 w-full">
        <button id="upload-photo-btn" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors min-h-[44px]">
          <i data-lucide="upload" class="w-4 h-4" aria-hidden="true"></i>
          <span>Upload Photo</span>
        </button>
        <button id="remove-photo-btn" class="hidden flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-100 text-gray-700 rounded-lg transition-colors min-h-[44px]">
          <i data-lucide="trash-2" class="w-4 h-4" aria-hidden="true"></i>
          <span>Remove</span>
        </button>
      </div>
      <button id="close-photo-modal" class="mt-4 text-gray-500 hover:text-gray-700 text-sm min-h-[44px]">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Change Password Bottom Sheet -->
<div id="password-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4">
  <div class="bottom-sheet-content bg-white w-full md:max-w-xl p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-4">Change Password</h3>
    <form id="password-form" class="space-y-4" novalidate>
      <div>
        <label for="current-password" class="block font-semibold text-gray-700 mb-1">Current Password <span class="text-red-500">*</span></label>
        <input type="password" id="current-password" name="currentPassword"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div>
        <label for="new-password" class="block font-semibold text-gray-700 mb-1">New Password <span class="text-red-500">*</span></label>
        <input type="password" id="new-password" name="newPassword"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
        <!-- Password Strength -->
        <div id="new-password-strength" class="mt-2 hidden">
          <div class="flex gap-1 mb-1">
            <div id="new-strength-bar-1" class="h-1 flex-1 rounded-full bg-gray-200"></div>
            <div id="new-strength-bar-2" class="h-1 flex-1 rounded-full bg-gray-200"></div>
            <div id="new-strength-bar-3" class="h-1 flex-1 rounded-full bg-gray-200"></div>
            <div id="new-strength-bar-4" class="h-1 flex-1 rounded-full bg-gray-200"></div>
          </div>
          <p id="new-strength-text" class="text-xs text-gray-500"></p>
        </div>
        <!-- Password Requirements -->
        <div id="new-password-requirements" class="mt-2 flex flex-wrap gap-x-3 gap-y-1 text-xs">
          <span id="new-req-length" class="text-gray-400">8+ chars</span>
          <span id="new-req-uppercase" class="text-gray-400">1 uppercase</span>
          <span id="new-req-number" class="text-gray-400">1 number</span>
        </div>
      </div>
      <div>
        <label for="confirm-password" class="block font-semibold text-gray-700 mb-1">Confirm New Password <span class="text-red-500">*</span></label>
        <input type="password" id="confirm-password" name="confirmPassword"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div class="flex flex-col sm:flex-row gap-3 pt-2">
        <button type="button" id="cancel-password" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px] whitespace-nowrap">
          Cancel
        </button>
        <button type="submit" id="save-password" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark min-h-[44px] whitespace-nowrap">
          Update Password
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Account Bottom Sheet -->
<div id="delete-account-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4">
  <div class="bottom-sheet-content bg-white w-full md:max-w-xl p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold text-red-600 mb-2">Delete Account</h3>
    <p class="text-gray-600 mb-4">This action is permanent and cannot be undone. All your books, genres, and data will be permanently deleted.</p>
    <form id="delete-account-form" class="space-y-4" novalidate>
      <div>
        <label for="delete-confirm-password" class="block font-semibold text-gray-700 mb-1">Enter your password to confirm <span class="text-red-500">*</span></label>
        <input type="password" id="delete-confirm-password" name="password"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
      </div>
      <div>
        <label for="delete-confirm-text" class="block font-semibold text-gray-700 mb-1">Type "DELETE" to confirm <span class="text-red-500">*</span></label>
        <input type="text" id="delete-confirm-text" name="confirmText" placeholder="DELETE"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
      </div>
      <div class="flex flex-col sm:flex-row gap-3 pt-2">
        <button type="button" id="cancel-delete-account" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px] whitespace-nowrap">
          Cancel
        </button>
        <button type="submit" id="confirm-delete-account" class="flex-1 py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 min-h-[44px] whitespace-nowrap">
          Delete Account
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-6 left-4 right-4 sm:left-auto sm:right-4 sm:w-80 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg z-50"></div>
