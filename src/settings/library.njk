---
layout: base.njk
title: Library Settings
scripts: '<script type="module" src="/js/settings/library.js"></script>'
---
<!-- Sub-navigation -->
<div class="bg-white border-b border-gray-200 sticky top-14 z-30">
  <div class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-between min-h-[52px]">
    <nav aria-label="Breadcrumb">
      <ol class="flex items-center text-sm">
        <li class="flex items-center min-w-0">
          <a href="/" class="text-gray-500 hover:text-primary hover:underline">Home</a>
        </li>
        <li class="flex items-center min-w-0">
          <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 mx-1 flex-shrink-0" aria-hidden="true"></i>
          <a href="/settings/" class="text-gray-500 hover:text-primary hover:underline">Settings</a>
        </li>
        <li class="flex items-center min-w-0">
          <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 mx-1 flex-shrink-0" aria-hidden="true"></i>
          <span class="text-gray-900 font-medium" aria-current="page">Library</span>
        </li>
      </ol>
    </nav>
  </div>
</div>

{% set activePage = 'library' %}
{% include "settings-nav.njk" %}

<div class="max-w-6xl mx-auto px-4 py-6">
  <div class="lg:flex lg:gap-8">
    <!-- Sidebar Navigation (Desktop Only) -->
    <aside class="hidden lg:block w-48 flex-shrink-0">
      <nav class="sticky top-36" aria-label="In this section">
        <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">In this section</h2>
        <ul class="space-y-1">
          <li><a href="#genres" class="section-link block py-1.5 px-2 text-sm text-gray-600 hover:text-primary hover:bg-gray-50 rounded-md">Genres</a></li>
          <li><a href="#series" class="section-link block py-1.5 px-2 text-sm text-gray-600 hover:text-primary hover:bg-gray-50 rounded-md">Series</a></li>
          <li><a href="#backup" class="section-link block py-1.5 px-2 text-sm text-gray-600 hover:text-primary hover:bg-gray-50 rounded-md">Backup & Restore</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 min-w-0 max-w-2xl mx-auto lg:mx-0 page-content">
      <h1 class="text-2xl font-bold text-gray-900 mb-4">Library</h1>

      <!-- Mobile Section Navigation (Pills) -->
      <nav class="lg:hidden mb-6 -mx-4 px-4 overflow-x-auto no-scrollbar" aria-label="Jump to section">
        <div class="flex gap-2">
          <a href="#genres" class="flex-shrink-0 px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors min-h-[44px] inline-flex items-center">Genres</a>
          <a href="#series" class="flex-shrink-0 px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors min-h-[44px] inline-flex items-center">Series</a>
          <a href="#backup" class="flex-shrink-0 px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors min-h-[44px] inline-flex items-center">Backup</a>
        </div>
      </nav>

      <!-- Genres Section -->
      <section id="genres" class="mb-8 scroll-mt-36">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Genres</h2>
      <button id="add-genre-btn" class="flex items-center gap-2 px-3 py-2 bg-primary hover:bg-primary-dark text-white text-sm rounded-lg transition-colors min-h-[44px]">
        <i data-lucide="plus" class="w-4 h-4" aria-hidden="true"></i>
        <span>Add</span>
      </button>
    </div>

        <!-- Loading State (Skeleton) -->
        <div id="genres-loading" class="bg-white rounded-xl border border-gray-200 overflow-hidden">
          <table class="w-full">
            <tbody class="divide-y divide-gray-100">
              {% for i in range(0, 4) %}
              <tr>
                <td class="py-1.5 px-3">
                  <div class="flex items-center gap-2">
                    <div class="skeleton w-3 h-3 rounded-full"></div>
                    <div class="skeleton skeleton-text w-24"></div>
                  </div>
                </td>
                <td class="py-1.5 px-3 text-right"><div class="skeleton skeleton-text w-4 ml-auto"></div></td>
                <td class="py-1.5 px-1"><div class="skeleton w-14 h-5 ml-auto"></div></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

    <!-- Empty State -->
    <div id="genres-empty" class="hidden py-8 text-center bg-white rounded-xl border border-gray-200">
      <i data-lucide="tags" class="w-12 h-12 text-gray-300 mx-auto" aria-hidden="true"></i>
      <h3 class="text-base font-medium text-gray-600 mt-3">No genres yet</h3>
      <p class="text-gray-400 text-sm mt-1">Create your first genre to organise books</p>
    </div>

    <!-- Genre List -->
    <div id="genre-list" class="space-y-2"></div>
  </section>

      <!-- Series Section -->
      <section id="series" class="mb-8 scroll-mt-36">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-gray-900">Series</h2>
      <button id="add-series-btn" class="flex items-center gap-2 px-3 py-2 bg-primary hover:bg-primary-dark text-white text-sm rounded-lg transition-colors min-h-[44px]">
        <i data-lucide="plus" class="w-4 h-4" aria-hidden="true"></i>
        <span>Add</span>
      </button>
    </div>

        <!-- Loading State (Skeleton) -->
        <div id="series-loading" class="bg-white rounded-xl border border-gray-200 overflow-hidden">
          <table class="w-full">
            <tbody class="divide-y divide-gray-100">
              {% for i in range(0, 4) %}
              <tr>
                <td class="py-1.5 px-3"><div class="skeleton skeleton-text w-32"></div></td>
                <td class="py-1.5 px-3 text-right"><div class="skeleton skeleton-text w-6 ml-auto"></div></td>
                <td class="py-1.5 px-1"><div class="skeleton w-20 h-5 ml-auto"></div></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

    <!-- Empty State -->
    <div id="series-empty" class="hidden py-8 text-center bg-white rounded-xl border border-gray-200">
      <i data-lucide="library" class="w-12 h-12 text-gray-300 mx-auto" aria-hidden="true"></i>
      <h3 class="text-base font-medium text-gray-600 mt-3">No series yet</h3>
      <p class="text-gray-400 text-sm mt-1">Add series to track book collections</p>
    </div>

    <!-- Series List -->
    <div id="series-list" class="space-y-2"></div>

    <!-- Duplicate Detection -->
    <div id="series-duplicates" class="hidden mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl">
      <div class="flex items-start gap-3">
        <i data-lucide="alert-triangle" class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" aria-hidden="true"></i>
        <div>
          <h4 class="font-medium text-amber-900">Potential Duplicates Found</h4>
          <p class="text-sm text-amber-700 mt-1">The following series may be duplicates. Consider merging them.</p>
          <div id="duplicate-list" class="mt-2 space-y-1"></div>
        </div>
      </div>
    </div>
  </section>

      <!-- Backup & Restore Section -->
      <section id="backup" class="mb-8 scroll-mt-36">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Backup & Restore</h2>

        <!-- Export -->
        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-4">
          <h3 class="font-medium text-gray-900 mb-2">Export Backup</h3>
          <p class="text-gray-600 text-sm mb-4">Download all your books and genres as a JSON file.</p>
          <button id="export-btn" class="flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors min-h-[44px]">
            <i data-lucide="download" class="w-4 h-4" aria-hidden="true"></i>
            <span>Download Backup</span>
          </button>
        </div>

        <!-- Import -->
        <div class="bg-white rounded-xl border border-gray-200 p-6">
          <h3 class="font-medium text-gray-900 mb-2">Import Backup</h3>
          <p class="text-gray-600 text-sm mb-4">Restore books and genres from a backup file. Duplicates will be skipped.</p>
          <input type="file" id="import-file" accept=".json" class="hidden">
          <button id="import-btn" class="flex items-center gap-2 px-4 py-2 border border-gray-300 hover:bg-gray-100 text-gray-700 rounded-lg transition-colors min-h-[44px]">
            <i data-lucide="upload" class="w-4 h-4" aria-hidden="true"></i>
            <span>Select Backup File</span>
          </button>
          <div id="import-progress" class="hidden mt-4">
            <div class="flex items-center gap-2 text-sm text-gray-600">
              <span class="inline-block animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"></span>
              <span id="import-status">Importing...</span>
            </div>
          </div>
          <!-- Import Summary (shown after import completes) -->
          <div id="import-summary" class="hidden mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
            <div class="flex items-center gap-2 mb-3">
              <i data-lucide="check-circle" class="w-5 h-5 text-green-600" aria-hidden="true"></i>
              <h4 class="font-medium text-gray-900">Import Complete</h4>
            </div>
            <div id="import-summary-content" class="space-y-2 text-sm text-gray-600"></div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<!-- Create/Edit Genre Bottom Sheet -->
<div id="genre-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-labelledby="genre-modal-title">
  <div class="bottom-sheet-content bg-white w-full md:max-w-md p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 id="genre-modal-title" class="text-lg font-semibold mb-4">Add Genre</h3>
    <form id="genre-form" class="space-y-4" novalidate>
      <div>
        <label for="genre-name" class="block font-semibold text-gray-700 mb-1">Name <span class="text-red-500">*</span></label>
        <input type="text" id="genre-name" name="name" placeholder="e.g., Science Fiction"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div id="color-picker-section" class="hidden">
        <span id="color-picker-label" class="block font-semibold text-gray-700 mb-2">Colour</span>
        <div id="color-picker" class="flex flex-wrap gap-2 max-h-48 overflow-y-auto p-1 -m-1" role="radiogroup" aria-labelledby="color-picker-label"></div>
      </div>
      <div class="flex gap-3 pt-2">
        <button type="button" id="cancel-genre" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
          Cancel
        </button>
        <button type="submit" id="save-genre" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark min-h-[44px]">
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Genre Confirmation Bottom Sheet -->
<div id="delete-genre-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-label="Delete genre confirmation">
  <div class="bottom-sheet-content bg-white w-full md:max-w-sm p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-2">Delete Genre?</h3>
    <p id="delete-genre-message" class="text-gray-500 mb-6">This will remove the genre from all books.</p>
    <div class="flex gap-3">
      <button id="cancel-delete-genre" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
        Cancel
      </button>
      <button id="confirm-delete-genre" class="flex-1 py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 min-h-[44px]">
        Delete
      </button>
    </div>
  </div>
</div>

<!-- Merge Genre Bottom Sheet -->
<div id="merge-genre-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-label="Merge genre">
  <div class="bottom-sheet-content bg-white w-full md:max-w-md p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-4">Merge Genre</h3>
    <p class="text-gray-600 text-sm mb-4">Merge "<span id="merge-genre-source-name" class="font-medium"></span>" into another genre. Books will be moved and the source genre will be deleted.</p>
    <div class="mb-4">
      <label for="merge-genre-target-select" class="block font-semibold text-gray-700 mb-1">Target Genre</label>
      <select id="merge-genre-target-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white">
        <option value="">Select a genre...</option>
      </select>
    </div>
    <div class="flex gap-3">
      <button id="cancel-merge-genre" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
        Cancel
      </button>
      <button id="confirm-merge-genre" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]" disabled>
        Merge
      </button>
    </div>
  </div>
</div>

<!-- Create/Edit Series Bottom Sheet -->
<div id="series-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-labelledby="series-modal-title">
  <div class="bottom-sheet-content bg-white w-full md:max-w-md p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 id="series-modal-title" class="text-lg font-semibold mb-4">Add Series</h3>
    <form id="series-form" class="space-y-4" novalidate>
      <div>
        <label for="series-name" class="block font-semibold text-gray-700 mb-1">Name <span class="text-red-500">*</span></label>
        <input type="text" id="series-name" name="name" placeholder="e.g., Harry Potter"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
      </div>
      <div>
        <label for="series-description" class="block font-semibold text-gray-700 mb-1">Description <span class="font-normal text-gray-400">(optional)</span></label>
        <textarea id="series-description" name="description" rows="2" placeholder="Notes about this series"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none resize-none"></textarea>
      </div>
      <div>
        <label for="series-total-books" class="block font-semibold text-gray-700 mb-1">Total Books <span class="font-normal text-gray-400">(optional)</span></label>
        <input type="number" id="series-total-books" name="totalBooks" placeholder="e.g., 7" inputmode="numeric"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none">
        <p class="text-xs text-gray-400 mt-1">How many books are in the complete series?</p>
      </div>
      <div class="flex gap-3 pt-2">
        <button type="button" id="cancel-series" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
          Cancel
        </button>
        <button type="submit" id="save-series" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark min-h-[44px]">
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Series Confirmation Bottom Sheet -->
<div id="delete-series-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-label="Delete series confirmation">
  <div class="bottom-sheet-content bg-white w-full md:max-w-sm p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-2">Delete Series?</h3>
    <p id="delete-series-message" class="text-gray-500 mb-6">This will unlink the series from all books.</p>
    <div class="flex gap-3">
      <button id="cancel-delete-series" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
        Cancel
      </button>
      <button id="confirm-delete-series" class="flex-1 py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 min-h-[44px]">
        Delete
      </button>
    </div>
  </div>
</div>

<!-- Merge Series Bottom Sheet -->
<div id="merge-series-modal" class="hidden fixed inset-0 bg-black/50 z-50 md:p-4" role="dialog" aria-modal="true" aria-label="Merge series">
  <div class="bottom-sheet-content bg-white w-full md:max-w-md p-6 md:mx-auto">
    <div class="bottom-sheet-handle md:hidden"></div>
    <h3 class="text-lg font-semibold mb-4">Merge Series</h3>
    <p class="text-gray-600 text-sm mb-4">Merge "<span id="merge-source-name" class="font-medium"></span>" into another series. Books will be moved and the source series will be deleted.</p>
    <div class="mb-4">
      <label for="merge-target-select" class="block font-semibold text-gray-700 mb-1">Target Series</label>
      <select id="merge-target-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none bg-white">
        <option value="">Select a series...</option>
      </select>
    </div>
    <div class="flex gap-3">
      <button id="cancel-merge-series" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 min-h-[44px]">
        Cancel
      </button>
      <button id="confirm-merge-series" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed min-h-[44px]" disabled>
        Merge
      </button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="hidden fixed bottom-6 left-4 right-4 sm:left-auto sm:right-4 sm:w-80 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg z-50"></div>
